import os, sys, time

from Platform import Platform

""" 
        @authors:
            Alejandro Balderrama
            Nadia Karichev
            Hector Cervantes
        @description
            This class is a subclass of platform. This class will implement the tiddlywiki platform. 
    """


class Results(Platform):
    # fill the values here for your specific platformResultsPlatform
    platform_name = ""
    platform_start_command = ""
    platform_end_command = ""
    platform_version = ""

   # the fields below will be generated by Platform Manager
    platform_install = ""
    platform_id = 0
    processID = 0
    subplatforms = {}
    port = ""
    ip = ""
    link = ""
    static = False 

    # return process ID
    def getProcessID(self):
        return self.processID

    # returns link to connect to website
    def getLink(self):
        return self.link

    # returns ip and port to connect to website
    def getIpPort(self):
        return self.ip + ":" + self.port

    # returns platform name
    def getPlatformName(self):
        return self.platform_name

    # returns where the platforms installation path
    def getPlatformInstallation(self):
        return self.platform_install

    # return the version of the platform
    def getPlatformVersion(self):
        return self.platform_version

    # return a platformID. You can pick a random value for this field.
    def getPlatformID(self):
        return self.platform_id

    # return command that starts platform
    def get_start_command(self):
        return self.platform_start_command

    # returns command to stop platform
    def get_stop_command(self):
        return self.platform_end_command

    # returns list of subplatforms
    def get_sub_platforms(self):
        return self.subplatforms

    def requestHandler(self, jsonObject):
        pass

    # sets process ID
    def setProcessID(self, processID):
        self.processID = processID

    # set link to connect to website
    def setLink(self, link):
        self.link = link

    # set ip and port to connect to website
    def setIpPort(self, ip, port):
        self.ip = ip
        self.port = port

        # set platform name

    def setPlatformName(self, platform_name):
        self.platform_name = platform_name

        # set where the platforms installation path

    def setPlatformInstallation(self, platformInstallation):
        self.platformInstallation = platformInstallation

        # sets the version of the platform

    def setPlatformVersion(self, platform_version):
        self.platform_version = platform_version

    # sets a platformID. You can pick a random value for this field.
    def setPlatformID(self, PlatformID):
        self.platform_id = PlatformID

    # sets command that starts platform
    def set_start_command(self, platform_start_command):
        self.platform_start_command = platform_start_command

    # set command to stop platform
    def set_stop_command(self, platform_end_command):
        self.platform_end_command = platform_end_command

    # set list of subplatforms
    def set_sub_platforms(self, subplatforms):
        self.subplatforms = subplatforms

        # add more methods below if you need to do more tasksct):
        print("Handling Request")

    def getFilesFromDir(self):
        path = 'tmp/'
        files = []
        subdirs = []
        for root, dirs, filenames in os.walk(path):
            for subdir in dirs:
                subdirs.append(os.path.relpath(os.path.join(root, subdir), path))

            for f in filenames:
                files.append(os.path.relpath(os.path.join(root, f), path))
        index = {}
        for f in files:
            index[f] = os.path.getmtime(os.path.join(path, f))
        files.sort()
        return files

    def init(self):
        return self.getFilesFromDir()

    #     fileList = open("list_of_initial_files.txt",'r')
    #     list_of_initial_files = []
    #     for line in fileList:
    #         fileName = path+""+line.strip()
    #         f = open(fileName, 'r')
    #         list_of_initial_files.append( f )
    #         print(f)
    #         time.sleep(1)
    #     print(list_of_initial_files)
    # #    list_of_initial_files.sort()
    #     return list_of_initial_files

    def diff(self, list1, list2):
        diff_list = []
        for item in list1:
            if not item in list2:
                diff_list.append(item)
        return diff_list

    def writeToFile(self, name, list):
        f = open(name, 'w')
        for x in list:
            f.write(x + "\n")
        f.close()

    def run(self):
        # Initial files in directory
        initial_curr_dir = self.init()
        print("Listening for new alerts...")
        while 1:
            tmp = self.getFilesFromDir()
            if len(self.diff(tmp, initial_curr_dir)) != 0:
                state = self.diff(tmp, initial_curr_dir)
                for newAlert in state:
                    print("ALERT: ", newAlert, " was added to folder")
                option = input("What do you want to do? ")
            time.sleep(2)

if __name__ == "__main__":
    app = Results()
    app.run()

# platform = Files()
# print(platform.get_start_command())
