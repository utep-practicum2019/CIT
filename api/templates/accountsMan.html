<!doctype html>
<html lang="en">
<head>
    <title>Account Manager</title>
    <style>
        #mainArea {
            width: 100%
            height: 100%
        }
        #groupArea {
            width: 100%;
            height: 100%
        }
    </style>


    <!-- Bootstrap core CSS -->
    <link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
          integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>

<!--<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>


<script type="text/javascript">
    visible = 1; //var that keeps track of which table is visible (1 or 2)
    function change_table() {
        var x = document.getElementById("MySelect").value;
        t1 = document.getElementById("groupArea");
        t2 = document.getElementById("mainArea");
        if (visible == 1) {
            visible = 2;
            t1.style.display = 'none';
            t2.style.display = 'block';
        } else {
            visible = 1;
            t1.style.display = 'block';
            t2.style.display = 'none';
        }
    }
</script>


<body onload="change_table()">
<div class="container-fluid">
    <img id="logo" src="http://www.teamorlando.org/wp-content/uploads/2012/11/ARL-2016.jpg">
    <div class="row">
        <div aria-label="First group" class="btn-group mr-2" role="group">

            <button class="btn btn-dark btn-sm menu" type="button"><a href="indexAdmin.html">Managers Menu</a></button>

            <button class="btn btn-dark btn-sm menu" type="button"><a href="connectionMan.html">Connection Manager</a>
            </button>

            <button class="btn btn-dark btn-sm menu active" type="button"><a href="accountsMan.html" id="pressed">Account
                Manager</a></button>

            <button class="btn btn-dark btn-sm menu" type="button"><a href="platMan.html">Platform Manager</a></button>

        </div>
    </div>
</div>
<div class="container-fluid">
    <h2>Accounts:</h2>

    <div class="row">
        <div aria-label="First group" class="btn-group mr-2" role="group">

            <button class="btn btn-dark btn-sm menu" data-target="#addModal" data-toggle="modal" type="button">
                Add Users
            </button>

            <button class="btn btn-dark btn-sm menu" data-target="#importModal" data-toggle="modal" type="button">
                Import Users
            </button>

            <button class="btn btn-dark btn-sm menu" type="button">
                Edit
            </button>

            <select class="btn btn-dark btn-sm menu" id="MySelect" onchange="change_table()">
                <option value="user_table">User table</option>
                <option value="group_table">Group table</option>
            </select>

            <button class="btn btn-dark btn-sm menu" data-target="#deleteUsersModal" data-toggle="modal" type="button">
                Delete Users
            </button>

            <button class="btn btn-dark btn-sm menu" data-target="#deleteGroupModal" data-toggle="modal" type="button">
                Delete Groups
            </button>


        </div>
    </div>

    <div class="table-responsive" id="mainArea">
        <table class="table table-hover" id="usersTab">
            <thead>
            <tr>
<!--                <th>Select:</th>-->
<!--                <th onclick="sortTable(0)">Username:</th>-->
<!--                <th>Password:</th>-->
<!--                <th onclick="sortTable(2)">Group:</th>-->
<!--                <th>Platform</th>-->
                <th>Select</th>
                <th><a href="javascript:SortTable(1,'T', 'usersTab');">Username</a></th>
                <th><a href="javascript:SortTable(2,'T', 'usersTab');">Password</a></th>
                <th><a href="javascript:SortTable(3,'N', 'usersTab');">Group</a></th>
                <th>Platform</th>
            </tr>
            </thead>
            <tbody>
            {% for user in users %}
            <tr>
                <td><input aria-label="Checkbox for following text input" id="user_name"
                           type="checkbox" value="{{ user['username'] }}"></td>
                <td>{{ user['username'] }}</td>
                <td>{{ user['password'] }}</td>
                <td>{{ user['group_id'] }}</td>
                <td>H</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>





</div>

<div class="container-fluid" id="groupArea">
    <table class="table table-hover" id="groupsTab">
        <thead>
<!--        <tr>-->
<!--            <th>Select:</th>-->
<!--            <th onclick="sortTable(0)">Group id:</th>-->
<!--            <th onclick="sortTable(1)">Members</th>-->
<!--            <th>Platform</th>-->
<!--        </tr>-->
        <tr>
            <th>Select</th>
            <th><a href="javascript:SortTable(1,'N', 'groupsTab');">Group ID</a></th>
            <th><a href="javascript:SortTable(2,'T', 'groupsTab');">Members</a></th>
            <th>Platform</th>
        </tr>
        </thead>
        <tbody>
        {% for group in groups %}
        <tr>
            <td><input aria-label="Checkbox for following text input" onclick="selectGroups()" type="checkbox"
                       value="{{ group['group_id'] }}"></td>
            <td>{{ group['group_id'] }}</td>
            <td>{{ group['members'] }}</td>
            <td>{{ group['platforms'] }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>


<script>
    $(document).ready(function () {
        $('#btnDelUsr').click(function () {
            let list_of_users = selectUsers();
            if (list_of_users.length === 0) {
                alert("Please select at least one user for deletion.");
            } else {
                $.ajax({
                    type: "DELETE",
                    url: "http://localhost:5001/api/v2/resources/user",
                    contentType: "application/json",
                    dataType: "json",
                    data: JSON.stringify({
                        "list_of_users": list_of_users
                    }),
                    success: function (response) {
                        // console.log(response["success"] + " status: " + status);
                        $("#groupsTab").load(location.href + " #groupsTab>*", "");
                        $("#usersTab").load(location.href + " #usersTab>*", "");
                        //location.reload();
                    },
                });
            }
        });
    });
    function selectUsers() {
        let list = [];
        $('#usersTab input[type=checkbox]').each(function () {
            if (this.checked) {
                console.log($(this).val());

                list.push($(this).val())
            }
        });
        return list;
    }
</script>

<!-- Delete Users Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="deleteUsersModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">

        <div class="modal-content">
            <form id="delUserForm">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Are you sure?</h5>
                    <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    All user information will be deleted. This action cannot be undone.
                </div>
            </form>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                <button class="btn btn-danger" data-dismiss="modal" id="btnDelUsr">Delete</button>
            </div>
        </div>

    </div>
</div>


<script>
    $(document).ready(function () {
        $('#groupDelBtn').click(function () {
            let list_of_groups = selectGroups();
            if (list_of_groups.length === 0) {
                alert("Please select at least one user for deletion.");
            } else {
                $.ajax({
                    type: "DELETE",
                    url: "http://localhost:5001/api/v2/resources/group",
                    contentType: "application/json",
                    dataType: "json",
                    data: JSON.stringify({
                        "list_of_groups": list_of_groups
                    }),
                    success: function (response) {
                        // console.log(response["success"] + " status: " + status);
                        $("#groupsTab").load(location.href + " #groupsTab>*", "");
                        $("#usersTab").load(location.href + " #usersTab>*", "");
                        //location.reload();
                    },
                });
            }
        });
    });
    function selectGroups() {
        let list = [];
        $('#groupsTab input[type=checkbox]').each(function () {
            if (this.checked) {
                console.log($(this).val());
                list.push($(this).val())
            }
        });
        return list;
    }
</script>

<!-- Delete Groups Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="deleteGroupModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form method='POST'>
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Are you sure?</h5>
                    <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    All users information in the group will be deleted. This action cannot be undone.
                </div>
            </form>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                <button class="btn btn-danger" data-dismiss="modal" id="groupDelBtn">Delete</button>
            </div>
        </div>
    </div>
</div>


<!-- Import Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="importModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Import Users</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Your file must be structured in the following manner:<br>
                user1 group1<br>
                user2 group1<br>
                user3 group2<br>
                user4 group2<br>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                <button class="btn btn-primary" type="button">Import</button>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $('#btnAddUsers').click(function () {
            let gcount = $("#group_count").val();
            let upgroup = $("#users_per_group").val();
            if (gcount === '' && upgroup === '') {
                alert("Please fill out the form");
            } else if (gcount === '' && upgroup !== '') {
                alert('Group Count field is required')
            } else if (upgroup === '' && gcount !== '') {
                alert('Users Per Group field is required')
            } else {
                $.post("http://localhost:5001/api/v2/resources/group", //Required URL of the page on server
                    JSON.stringify({
                        "group_count": gcount,
                        "users_per_group": upgroup
                    }),
                    function () { // Required Callback Function
                        $("#groupsTab").load(location.href + " #groupsTab>*", "");
                        $("#usersTab").load(location.href + " #usersTab>*", "");
                    });
            }
        });
    });
</script>


<!-- Add Users Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="addModal" name="addModal"
     role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Users</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-footer">
                <div class="modal-body">

                    <form id="addUsersForm">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Number of groups:</span>
                            </div>
                            <input aria-describedby="basic-addon1" class="form-control" id="group_count"
                                   name="group_num"
                                   type="text">
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Users per group:</span>
                            </div>
                            <input aria-describedby="basic-addon1" class="form-control" id="users_per_group"
                                   name="users_group"
                                   type="text">
                            <input id="group_id" name="group_id" type="hidden" value="1000">
                        </div>
                    </form>
                    <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                    <button class="btn btn-primary" data-dismiss="modal" id="btnAddUsers">Add Users</button>


                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    /*
       Willmaster Table Sort
       Version 1.1
       August 17, 2016
       Updated GetDateSortingKey() to correctly sort two-digit months and days numbers with leading 0.
       Version 1.0, July 3, 2011

       Will Bontrager
       https://www.willmaster.com/
       Copyright 2011,2016 Will Bontrager Software, LLC

       This software is provided "AS IS," without
       any warranty of any kind, without even any
       implied warranty such as merchantability
       or fitness for a particular purpose.
       Will Bontrager Software, LLC grants
       you a royalty free license to use or
       modify this software provided this
       notice appears on all copies.
    */
    //
    // One placed to customize - The id value of the table tag.

    let TableIDvalue = '';

    //
    //////////////////////////////////////
    let TableLastSortedColumn = -1;

    function SortTable() {
        var sortColumn = parseInt(arguments[0]);
        var type = arguments.length > 1 ? arguments[1] : 'T';
        var dateformat = '';
        if( type==='D' ){
            dateformat = arguments.length > 2 ? arguments[2] : '';
            TableIDvalue = arguments[3];
        } else {
            TableIDvalue = arguments[2];
        }
        // var dateformat = arguments.length > 2 ? arguments[2] : '';
        var table = document.getElementById(TableIDvalue);
        var tbody = table.getElementsByTagName("tbody")[0];
        var rows = tbody.getElementsByTagName("tr");
        var arrayOfRows = [];
        type = type.toUpperCase();
        dateformat = dateformat.toLowerCase();
        for(var i=0, len=rows.length; i<len; i++) {
            arrayOfRows[i] = {};
            arrayOfRows[i].oldIndex = i;
            var celltext = rows[i].getElementsByTagName("td")[sortColumn].innerHTML.replace(/<[^>]*>/g,"");
            if( type==='D' ) { arrayOfRows[i].value = GetDateSortingKey(dateformat,celltext); }
            else {
                var re = type==="N" ? /[^.\-+\d]/g : /[^a-zA-Z0-9]/g;
                arrayOfRows[i].value = celltext.replace(re,"").substr(0,25).toLowerCase();
            }
        }
        if (sortColumn === TableLastSortedColumn) { arrayOfRows.reverse(); }
        else {
            TableLastSortedColumn = sortColumn;
            switch(type) {
                case "N" : arrayOfRows.sort(CompareRowOfNumbers); break;
                case "D" : arrayOfRows.sort(CompareRowOfNumbers); break;
                default  : arrayOfRows.sort(CompareRowOfText);
            }
        }
        var newTableBody = document.createElement("tbody");
        for(var i=0, len=arrayOfRows.length; i<len; i++) {
            newTableBody.appendChild(rows[arrayOfRows[i].oldIndex].cloneNode(true));
        }
        table.replaceChild(newTableBody,tbody);
    } // function SortTable()

    /**
     * @return {number}
     */
    function CompareRowOfText(a,b) {
        var aval = a.value;
        var bval = b.value;
        return( aval == bval ? 0 : (aval > bval ? 1 : -1) );
    } // function CompareRowOfText()

    /**
     * @return {number}
     */
    function CompareRowOfNumbers(a,b) {
        var aval = /\d/.test(a.value) ? parseFloat(a.value) : 0;
        var bval = /\d/.test(b.value) ? parseFloat(b.value) : 0;
        return( aval == bval ? 0 : (aval > bval ? 1 : -1) );
    } // function CompareRowOfNumbers()

    /**
     * @return {string}
     */
    function GetDateSortingKey(format,text) {
        if( format.length < 1 ) { return ""; }
        format = format.toLowerCase();
        text = text.toLowerCase();
        text = text.replace(/^[^a-z0-9]*/,"");
        text = text.replace(/[^a-z0-9]*$/,"");
        if( text.length < 1 ) { return ""; }
        text = text.replace(/[^a-z0-9]+/g,",");
        var date = text.split(",");
        if( date.length < 3 ) { return ""; }
        var d=0, m=0, y=0;
        for( var i=0; i<3; i++ ) {
            var ts = format.substr(i,1);
            if( ts === "d" ) { d = date[i]; }
            else if( ts === "m" ) { m = date[i]; }
            else if( ts === "y" ) { y = date[i]; }
        }
        d = d.replace(/^0/,"");
        if( d < 10 ) { d = "0" + d; }
        if( /[a-z]/.test(m) ) {
            m = m.substr(0,3);
            switch(m) {
                case "jan" : m = String(1); break;
                case "feb" : m = String(2); break;
                case "mar" : m = String(3); break;
                case "apr" : m = String(4); break;
                case "may" : m = String(5); break;
                case "jun" : m = String(6); break;
                case "jul" : m = String(7); break;
                case "aug" : m = String(8); break;
                case "sep" : m = String(9); break;
                case "oct" : m = String(10); break;
                case "nov" : m = String(11); break;
                case "dec" : m = String(12); break;
                default    : m = String(0);
            }
        }
        m = m.replace(/^0/,"");
        if( m < 10 ) { m = "0" + m; }
        y = parseInt(y);
        if( y < 100 ) { y = parseInt(y) + 2000; }
        return "" + String(y) + "" + String(m) + "" + String(d) + "";
    } // function GetDateSortingKey()
</script>


    <!--    <script crossorigin="anonymous"-->
    <!--            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"-->
    <!--            src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>-->
    <script crossorigin="anonymous"
            integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
    <script crossorigin="anonymous"
            integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
</body>
</html>