<!doctype html>
<!--suppress JSUnfilteredForInLoop, JSDeprecatedSymbols -->
<html lang="en">
<head>
    <title>Account Manager</title>
    <style>
        #mainArea {
            width: 100%;
            height: 100%
        }

        #groupArea {
            width: 100%;
            height: 100%
        }

        .label_padding {
            padding-left: 18px;
            padding-bottom: 10px;
        }
    </style>
    <!-- Bootstrap core CSS -->
    <link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
          integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" rel="stylesheet">
</head>

<body>
<div class="container-fluid">
    <img alt="" id="logo" src="http://www.teamorlando.org/wp-content/uploads/2012/11/ARL-2016.jpg">
    <div class="row">
        <div aria-label="First group" class="btn-group mr-2" role="group">
            <!--            <button class="btn btn-dark btn-sm menu" type="button"><a href="indexAdmin.html">Managers Menu</a></button>-->
            <button class="btn btn-dark btn-sm menu" type="button"><a href="connectionMan.html">Connection Manager</a>
            </button>

            <button class="btn btn-dark btn-sm menu active" type="button"><a href="accountsMan.html" id="pressed">Account
                Manager</a></button>

            <button class="btn btn-dark btn-sm menu" type="button"><a href="platMan.html">Platform Manager</a></button>

        </div>
    </div>
</div>


<div class="container-fluid">
    <h2>Accounts:</h2>
    <div class="row">
        <div aria-label="First group">
            <label class="label_padding">
                <button class="btn btn-dark btn-sm menu" data-target="#addModal" data-toggle="modal" type="button">
                    Add
                </button>

                <!--                <button class="btn btn-dark btn-sm menu" data-target="#importModal" data-toggle="modal" type="button">-->
                <!--                    Import Users-->
                <!--                </button>-->

                <select class="btn btn-dark btn-sm menu" id="MySelect" onchange="change_table()">
                    <option value="user_table">User table</option>
                    <option value="group_table">Group table</option>
                </select>

                <button class="btn btn-dark btn-sm menu" data-target="#deleteUsersModal" data-toggle="modal"
                        id="delUsersModalBtn" type="button">
                    Delete Users
                </button>

                <button class="btn btn-dark btn-sm menu" data-target="#deleteGroupModal" data-toggle="modal"
                        id="delGroupsModalBtn" type="button">
                    Delete Groups
                </button>

                <button class="btn btn-dark btn-sm menu" data-target="#attachPlatformModal" data-toggle="modal"
                        id="platModalBtn" type="button">
                    Attach Platform
                </button>
            </label>
        </div>

    </div>

</div>

<!-- Users Table -->
<div class="table-responsive" id="mainArea">
    <table class="table table-hover" id="usersTab">
        <thead>
        <tr>
            <th style="text-align:center; vertical-align:middle;">
                <div>
<!--                    <a href="javascript:users_check_uncheck_all()"> Select</a>-->
<!--                    <button id="users_check_uncheck_all" onclick="users_check_uncheck_all()">Check</button>-->
                    <button id="user_check_all" onclick="check_all('users_checkbox_platform')">Check</button>
                    <button id="user_uncheck_all" onclick="uncheck_all('users_checkbox_platform')">Uncheck</button>
                </div>
            </th>
            <th><a href="javascript:SortTable(1,'T', 'usersTab');">Username</a></th>
            <th><a href="javascript:SortTable(2,'T', 'usersTab');">Password</a></th>
            <th><a href="javascript:SortTable(3,'N', 'usersTab');">Group</a></th>
            <th>
                <div><a href="javascript:SortTable(4,'T', 'usersTab');">Aliases</a>
                    <button id="saveUserAliasBtn">Save</button>
                    <button id="clearUserAliasBtn">Clear</button>

                </div>
            </th>
            <th>
                <div><a href="javascript:SortTable(5,'T', 'usersTab');">Notes</a>
                    <button id="saveUserNotesBtn"> Save</button>
                    <button id="clearUserNotesBtn">Clear</button>

                </div>
            </th>
            <th>Platforms</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<!-- Groups Table -->
<div class="container-fluid" id="groupArea">
    <table class="table table-hover" id="groupsTab">
        <thead>
        <tr>
            <th style="text-align:center; vertical-align:middle;">
                <div>
<!--                    <a href="javascript:group_check_uncheck_all()"> Select</a>-->
<!--                    <button id="group_check_uncheck_all" onclick="group_check_uncheck_all()">Check</button>-->
                    <button id="group_check_all" onclick="check_all('groups_checkbox_platform')">Check</button>
                    <button id="group_uncheck_all" onclick="uncheck_all('groups_checkbox_platform')">Uncheck</button>
                </div>
            </th>
            <th><a href="javascript:SortTable(1,'N', 'groupsTab');">Group ID</a></th>
            <th><a href="javascript:SortTable(2,'T', 'groupsTab');">Members</a></th>
            <th>
                <div><a href="javascript:SortTable(3,'T', 'groupsTab');">Alias</a>
                    <button id="saveGroupAliasBtn">Save</button>
                    <button id="clearGroupAliasBtn">Clear</button>
                </div>
            </th>
            <th>
                <div><a href="javascript:SortTable(4,'T', 'groupsTab');">Notes</a>
                    <button id="saveGroupNotesBtn"> Save</button>
                    <button id="clearGroupNotesBtn">Clear</button>
                </div>
            </th>
            <th>Platforms</th>
        </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</div>

<!-- Attach Platforms Modal -->
<div aria-hidden="true" class="modal fade" id="attachPlatformModal" role="dialog" tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form id="attachPlatformForm">
                <div class="modal-body">
                    <div>
                        <div style="text-align: center"><b> Main Platforms </b></div>
                        <label id="mainPlatRadio">
                            <input name="mainPlat" type="checkbox" value="TiddlyWiki"> Male<br>
                            <input name="mainPlat" type="checkbox" value="Rocketchat"> Female<br>
                        </label>
                    </div>
                </div>
            </form>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                <button class="btn btn-danger" data-dismiss="modal" id="attachPlatBtn">Attach</button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Users Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="deleteUsersModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">

        <div class="modal-content">
            <form id="delUserForm">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Are you sure?</h5>
                    <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    All user information will be deleted. This action cannot be undone.
                </div>
            </form>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                <button class="btn btn-danger" data-dismiss="modal" id="btnDelUsr">Delete</button>
            </div>
        </div>

    </div>
</div>

<!-- Delete Groups Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="deleteGroupModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form method='POST'>
                <div class="modal-header">
                    <h5 class="modal-title">Are you sure?</h5>
                    <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    All users information in the group will be deleted. This action cannot be undone.
                </div>
            </form>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                <button class="btn btn-danger" data-dismiss="modal" id="groupDelBtn">Delete</button>
            </div>
        </div>
    </div>
</div>

<!-- Import Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="importModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Import Users</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Your file must be structured in the following manner:<br>
                user1 group1<br>
                user2 group1<br>
                user3 group2<br>
                user4 group2<br>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                <button class="btn btn-primary" type="button">Import</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Users Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="addModal"
     role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Users</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-footer">
                <div class="modal-body">
                    <form id="addUsersForm">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text">Number of groups:</span>
                            </div>
                            <label for="group_count">
                                <input aria-describedby="basic-addon1" class="form-control" id="group_count"
                                       name="group_num"
                                       onkeypress="return isNumberKey(event)" type="text">
                            </label>
                            <div class="input-group-prepend">
                                <span class="input-group-text">Users per group:</span>
                            </div>
                            <label for="users_per_group">
                                <input aria-describedby="basic-addon1" class="form-control" id="users_per_group"
                                       name="users_group"
                                       onkeypress="return isNumberKey(event)" type="text">
                            </label>
                            <input id="group_id" name="group_id" type="hidden" value="1000">
                        </div>
                    </form>
                    <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                    <button class="btn btn-primary" data-dismiss="modal" id="btnAddUsers">Add Users</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script src="/static/js/tablesorter.js" type="text/javascript"></script>
<script crossorigin="anonymous"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
<script crossorigin="anonymous"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>

<script src="/static/js/notify.js" type="text/javascript"></script>
<script src="/static/js/remarkable-bootstrap-notify/bootstrap-notify.js" type="text/javascript"></script>

<script>
    let groupsVisible = 0; //var that keeps track of which table is groupsVisible (1 or 0)
    let users_check = true;
    let group_check = true;
    let users_num = 1;
    let groups_num = 1;
    //shows groups on GUI's table
    (function load_groups() {
        // noinspection JSUnusedGlobalSymbols
        $.ajax({
            type: "GET",
            url: "http://0.0.0.0:5001/api/v2/resources/group",
            contentType: "application/json",
            dataType: "json",
            data: {},
            success: function (response) {
                //Print results
                console.log("Accessed Database at " + new Date().toUTCString());
                let groups = response;
                let group_table_html = '<tbody>';
                for (let i in groups) {
                    let members = groups[i]["members"];
                    let group_id = groups[i]["group_id"];
                    let platforms = groups[i]["platforms"];
                    let note = groups[i]["note"];
                    let alias = groups[i]["alias"];
                    group_table_html += '<tr>';
                    group_table_html += '<td style="text-align:center; vertical-align:middle;"> <input aria-label="Checkbox for following text input" name="groups_checkbox_platform" type="checkbox" value="' + group_id + '"> </td>';
                    group_table_html += `<td>${group_id}</td>`;
                    group_table_html += `<td>${members}</td>`;
                    group_table_html +=
                        '<td>' +
                        ' <form>' +
                        '<label>' +
                        '<input type="text" name="groupAliasBox" value="' + alias + '">' +
                        '</label>' +
                        '</form>' +
                        '</td>';
                    group_table_html +=
                        '<td>' +
                        ' <form>' +
                        '<label>' +
                        '<input type="text" name="groupNoteBox" value="' + note + '">' +
                        '</label>' +
                        '</form>' +
                        '</td>';
                    group_table_html += `<td>${platforms}</td>`;
                    group_table_html += '</tr>';
                }
                group_table_html += '</tbody>';
                $('#groupsTab tbody').replaceWith(group_table_html);
                SortTable(1, 'T', 'groupsTab', true)
            },
            complete: function () {
                load_users();
                hide_group_options();
                SortTable(1, 'T', 'usersTab');
                SortTable(1, 'N', 'groupsTab', true);
            }
        });
    })();

    // Refresh the group table on GUI
    function reload_groups() {
        // noinspection JSUnusedGlobalSymbols
        $.ajax({
            type: "GET",
            url: "http://0.0.0.0:5001/api/v2/resources/group",
            contentType: "application/json",
            dataType: "json",
            data: {},
            success: function (response) {
                //Print results
                console.log("Accessed Database at " + new Date().toUTCString() + " Retrieved Groups");
                let groups = response;
                let group_table_html = '<tbody>';
                for (let i in groups) {
                    let members = groups[i]["members"];
                    let group_id = groups[i]["group_id"];
                    let platforms = groups[i]["platforms"];
                    let note = groups[i]["note"];
                    let alias = groups[i]["alias"];
                    group_table_html += '<tr>';
                    group_table_html += '<td style="text-align:center; vertical-align:middle;"> <input aria-label="Checkbox for following text input" name="groups_checkbox_platform" type="checkbox" value="' + group_id + '"> </td>';
                    group_table_html += `<td>${group_id}</td>`;
                    group_table_html += `<td>${members}</td>`;
                    group_table_html +=
                        '<td>' +
                        ' <form>' +
                        '<label>' +
                        '<input type="text" name="groupAliasBox" value="' + alias + '">' +
                        '</label>' +
                        '</form>' +
                        '</td>';
                    group_table_html +=
                        '<td>' +
                        ' <form>' +
                        '<label>' +
                        '<input type="text" name="groupNoteBox" value="' + note + '">' +
                        '</label>' +
                        '</form>' +
                        '</td>';
                    group_table_html += `<td>${platforms}</td>`;
                    group_table_html += '</tr>';
                }
                group_table_html += '</tbody>';
                $('#groupsTab tbody').replaceWith(group_table_html);
            },
            complete: function () {
                load_users()
            }
        });
    }

    //Reload the group notes on GUI
    function reload_group_notes() {
        // noinspection JSUnusedGlobalSymbols
        $.ajax({
            type: "GET",
            url: "http://0.0.0.0:5001/api/v2/resources/group",
            contentType: "application/json",
            dataType: "json",
            data: {},
            success: function (response) {
                //Print results
                console.log("Accessed Database at " + new Date().toUTCString() + " Retrieved Groups");
                let groups = response;
                for (let i in groups) {
                    let note = groups[i]["note"];
                    $('#groupsTab > tbody').each(function () {
                        $(this).find('tr:eq(' + i + ')').find('td:eq(4)').find('input[name="groupNoteBox"]').val(note);
                    });
                }
            }
        });
    }

    // Reload the user notes on GUI
    function reload_user_notes() {
        // noinspection JSUnusedGlobalSymbols
        $.ajax({
            type: "GET",
            url: "http://0.0.0.0:5001/api/v2/resources/user",
            contentType: "application/json",
            dataType: "json",
            data: {},
            success: function (response) {
                //Print results
                console.log("Accessed Database at " + new Date().toUTCString() + " Retrieved Users");
                let users = response;
                for (let i in users) {
                    let note = users[i]["note"];
                    $('#usersTab > tbody').each(function () {
                        $(this).find('tr:eq(' + i + ')').find('td:eq(5)').find('input[name="userNoteBox"]').val(note);
                    });
                }
            }
        });
    }

    // Reload the user aliases on GUI
    function reload_user_aliases() {
        // noinspection JSUnusedGlobalSymbols
        $.ajax({
            type: "GET",
            url: "http://0.0.0.0:5001/api/v2/resources/user",
            contentType: "application/json",
            dataType: "json",
            data: {},
            success: function (response) {
                //Print results
                console.log("Accessed Database at " + new Date().toUTCString() + " Retrieved Users");
                let users = response;
                for (let i in users) {
                    let alias = users[i]["alias"];
                    $('#usersTab > tbody').each(function () {
                        $(this).find('tr:eq(' + i + ')').find('td:eq(4)').find('input[name="userAliasBox"]').val(alias);
                    });
                }
            },
            complete: function () {
                reload_group_members();
            }
        });
    }

    function reload_group_members() {
        // noinspection JSUnusedGlobalSymbols
        $.ajax({
            type: "GET",
            url: "http://0.0.0.0:5001/api/v2/resources/group",
            contentType: "application/json",
            dataType: "json",
            data: {},
            success: function (response) {
                //Print results
                console.log("Accessed Database at " + new Date().toUTCString() + " Retrieved Groups");
                let groups = response;
                for (let i in groups) {
                    let members = groups[i]["members"];
                    $('#groupsTab > tbody').each(function () {
                        $(this).find('tr:eq(' + i + ')').find('td:eq(2)').replaceWith(`<td>${members}</td>`);
                    });
                }
            }
        });
    }

    // Reload the group aliases on GUI
    function reload_group_aliases() {
        // noinspection JSUnusedGlobalSymbols
        $.ajax({
            type: "GET",
            url: "http://0.0.0.0:5001/api/v2/resources/group",
            contentType: "application/json",
            dataType: "json",
            data: {},
            success: function (response) {
                //Print results
                console.log("Accessed Database at " + new Date().toUTCString() + " Retrieved Groups");
                let groups = response;
                for (let i in groups) {
                    let alias = groups[i]["alias"];
                    $('#groupsTab > tbody').each(function () {
                        $(this).find('tr:eq(' + i + ')').find('td:eq(3)').find('input[name="groupAliasBox"]').val(alias);
                    });
                }
            },
            complete: function () {
                reload_user_group_ids();
            }
        });
    }

    // Reload the user aliases on GUI
    function reload_user_group_ids() {
        // noinspection JSUnusedGlobalSymbols
        $.ajax({
            type: "GET",
            url: "http://0.0.0.0:5001/api/v2/resources/user",
            contentType: "application/json",
            dataType: "json",
            data: {},
            success: function (response) {
                //Print results
                console.log("Accessed Database at " + new Date().toUTCString() + " Retrieved Users");
                let users = response;
                for (let i in users) {
                    let group = users[i]["group_id"];
                    $('#usersTab > tbody').each(function () {
                        $(this).find('tr:eq(' + i + ')').find('td:eq(3)').replaceWith(`<td>${group}</td>`);
                    });
                }
            }
        });
    }

    // Shows users on GUI's table
    function load_users() {
        // noinspection JSUnusedGlobalSymbols
        $.ajax({
            type: "GET",
            url: "http://0.0.0.0:5001/api/v2/resources/user",
            contentType: "application/json",
            dataType: "json",
            data: {},
            success: function (response) {
                //Print results
                console.log("Accessed Database at " + new Date().toUTCString());
                let users = response;
                let user_table_html = '<tbody>';
                for (let i in users) {
                    let username = users[i]["username"];
                    let group_id = users[i]["group_id"];
                    let password = users[i]["password"];
                    let alias = users[i]["alias"];
                    let note = users[i]["note"];
                    user_table_html += '<tr>';
                    user_table_html += '<td style="text-align:center; vertical-align:middle;"><input aria-label="Checkbox for following text input" name="users_checkbox_platform"  type="checkbox" value="' + username + '"></td>';
                    user_table_html += `<td>${username}</td>`;
                    user_table_html += `<td>${password}</td>`;
                    user_table_html += `<td>${group_id}</td>`;
                    user_table_html +=
                        '<td>' +
                        '<form>' +
                        '<label>' +
                        '<input type="text" name="userAliasBox" value="' + alias + '">' +
                        '</label>' +
                        '</form>' +
                        '</td>';
                    user_table_html +=
                        '<td>' +
                        '<form>' +
                        '<label>' +
                        '<input type="text" name="userNoteBox" value="' + note + '">' +
                        '</label>' +
                        '</form>' +
                        '</td>';
                    user_table_html += '</tr>';
                }
                user_table_html += '</tbody>';
                $('#usersTab tbody').replaceWith(user_table_html);
            },
            complete: function () {
                load_plats_for_users();
            }
        });
    }

    function load_plats_for_users() {
        $.ajax({
            type: "GET",
            url: "http://0.0.0.0:5001/api/v2/resources/group",
            contentType: "application/json",
            dataType: "json",
            data: {},
            success: function (response) {
                //Print results
                console.log("Accessed Database at " + new Date().toUTCString());
                let groups = response;
                for (let i in groups) {
                    let group_id = groups[i]["group_id"];
                    let platforms = groups[i]["platforms"];
                    $("#usersTab tbody tr").each(function () {
                        let data = $(this).find('td:eq(3)').text();
                        if (parseInt(data) === group_id) {
                            let platform_html = `<td>${platforms}</td>`;
                            $(this).append(platform_html);
                        }
                    });
                }
            },
        });
    }

    //Change between users table and group table
    function change_table() {
        let groupsTable = document.getElementById("groupArea");
        let usersTable = document.getElementById("mainArea");
        let delGroupsButton = document.getElementById("delGroupsModalBtn");
        let delUsersButton = document.getElementById("delUsersModalBtn");
        let addPlatsButton = document.getElementById("platModalBtn");
        if (groupsVisible === 1) {
            groupsVisible = 0;
            usersTable.style.display = 'inline-block';
            delUsersButton.style.display = 'inline-block';
            groupsTable.style.display = 'none';
            delGroupsButton.style.display = 'none';
            addPlatsButton.style.display = 'none';
        } else {
            groupsVisible = 1;
            usersTable.style.display = 'none';
            delUsersButton.style.display = 'none';
            groupsTable.style.display = 'inline-block';
            delGroupsButton.style.display = 'inline-block';
            addPlatsButton.style.display = 'inline-block';
        }
    }

    //Hide group buttons
    function hide_group_options() {
        let groupsTable = document.getElementById("groupArea");
        let delGroupsButton = document.getElementById("delGroupsModalBtn");
        let addPlatsButton = document.getElementById("platModalBtn");
        groupsTable.style.display = 'none';
        delGroupsButton.style.display = 'none';
        addPlatsButton.style.display = 'none';
    }

    // Add groups
    function addToGroup(groups, index, to_add) {
        if (index < groups.length) {
            let group_id = groups[index]["group_id"];
            let group_object = {
                "group_id": group_id,
            };
            switch (to_add) {
                case "Note":
                    group_object["note"] = groups[index]["note"];
                    break;
                case "Alias":
                    group_object["alias"] = groups[index]["alias"];
                    break;
            }
            $.ajax({
                type: "PUT",
                url: "http://0.0.0.0:5001/api/v2/resources/group",
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify({
                    "group_id": group_id,
                    "updated_group": group_object
                }),
                success: function (response) {
                    console.log(JSON.stringify(response));
                },
                complete: function () {
                    addToGroup(groups, index + 1, to_add);
                }
            });
        } else {
            switch (to_add) {
                case "Note":
                    reload_group_notes();
                    break;
                case "Alias":
                    reload_group_aliases();
                    break;
            }
        }
    }

    // Add users
    function addToUser(users, index, to_add) {
        if (index < users.length) {
            let username = users[index]["username"];
            let user_object = {
                "username": username,
            };
            switch (to_add) {
                case "Note":
                    user_object["note"] = users[index]["note"];
                    break;
                case "Alias":
                    user_object["alias"] = users[index]["alias"];
                    break;
            }
            $.ajax({
                type: "PUT",
                url: "http://0.0.0.0:5001/api/v2/resources/user",
                contentType: "application/json",
                dataType: "json",
                data: JSON.stringify({
                    "username": username,
                    "updated_user": user_object
                }),
                success: function (response) {
                    console.log(JSON.stringify(response));
                },
                complete: function () {
                    addToUser(users, index + 1, to_add);
                }
            });
        } else {
            switch (to_add) {
                case "Note":
                    reload_user_notes();
                    break;
                case "Alias":
                    reload_user_aliases();
                    break;
            }
        }
    }

    // Select users ID
    function selectUserIDs() {
        let list = [];
        $('#usersTab input[type=checkbox]').each(function () {
            if (this.checked) {
                console.log($(this).val());

                list.push($(this).val())
            }
        });
        return list;
    }

    // Select groups ID
    function selectGroupIDs() {
        let list = [];
        $('#groupsTab input[type=checkbox]').each(function () {
            if (this.checked) {
                console.log($(this).val());
                list.push($(this).val())
            }
        });
        return list;
    }

    // Create a list of group objects from the table
    function selectGroupObjectsNoCheck() {
        let groups = [];
        $('#groupsTab > tbody > tr').each(function () {
            groups.push({
                'members': $(this).find('td:eq(2)').text(),
                'group_id': $(this).find('td:eq(1)').text(),
                'alias': $(this).find('td:eq(3)').find('input[name="groupAliasBox"]').val(),
                'note': $(this).find('td:eq(4)').find('input[name="groupNoteBox"]').val(),
                'platforms': $(this).find('td:eq(5)').text()
            });
        });
        return groups;
    }

    // Create a list of users objects from the table
    function selectUserObjectsNoCheck() {
        let users = [];
        $('#usersTab > tbody > tr').each(function () {
            users.push({
                'username': $(this).find('td:eq(1)').text(),
                'password': $(this).find('td:eq(2)').text(),
                'group': $(this).find('td:eq(3)').text(),
                'alias': $(this).find('td:eq(4)').find('input[name="userAliasBox"]').val(),
                'note': $(this).find('td:eq(5)').find('input[name="userNoteBox"]').val(),
                'platforms': $(this).find('td:eq(6)').text()
            });
        });
        return users;
    }

    // Check and uncheck all the selection boxes on user table
    function users_check_uncheck_all() {
        let checkboxes = document.getElementsByName("users_checkbox_platform");
        let button = document.getElementById("users_check_uncheck_all");
        for (let i = 0; i < checkboxes.length; i++) {
            checkboxes[i].checked = users_check;
        }
        users_check = !users_check;
        if (users_num === 0) {
            button.innerHTML = "Uncheck";
            users_num = 1;
        } else if (users_num === 1) {
            button.innerHTML = "Check";
            users_num = 0;
        }
    }

    // Check and uncheck all the selection boxes on group table
    function group_check_uncheck_all() {
        let checkboxes = document.getElementsByName("groups_checkbox_platform");
        let button = document.getElementById("group_check_uncheck_all");
        for (let i = 0; i < checkboxes.length; i++) {
            checkboxes[i].checked = group_check;
        }
        group_check = !group_check;
        if (groups_num === 0) {
            button.innerHTML = "Uncheck";
            groups_num = 1;
        } else if (groups_num === 1) {
            button.innerHTML = "Check";
            groups_num = 0;
        }
    }

    function check_all(table) {
        let checkboxes = document.getElementsByName(table);
        for (let i = 0; i < checkboxes.length; i++) {
            checkboxes[i].checked = true;
        }
    }

    function uncheck_all(table) {
        let checkboxes = document.getElementsByName(table);
        for (let i = 0; i < checkboxes.length; i++) {
            checkboxes[i].checked = false;
        }
    }


    // Allows only numbers on text box
    function isNumberKey(evt) {
        const charCode = (evt.which) ? evt.which : evt.keyCode;
        return !(charCode > 31 && (charCode < 48 || charCode > 57));
    }

    // Save Group Notes
    $(document).ready(function () {
        $('#saveGroupNotesBtn').click(function () {
            let groups = selectGroupObjectsNoCheck();
            if (groups.length < 1) {
                $.notify("At least one group must be selected!", {
                    type: 'danger',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });            } else {
                addToGroup(groups, 0, "Note");
                $.notify("Group Notes saved.", {
                    type: 'success',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });                //console.log(JSON.stringify(groups));
            }
        });
    });

    // Save User Notes
    $(document).ready(function () {
        $('#saveUserNotesBtn').click(function () {
            let users = selectUserObjectsNoCheck();
            if (users.length < 1) {
                $.notify("At least one user must be selected!", {
                    type: 'danger',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });            } else {
                addToUser(users, 0, "Note");
                $.notify("Group Notes saved.", {
                    type: 'success',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });            }
        });
    });


    // Save Group Aliases
    $(document).ready(function () {
        $('#saveGroupAliasBtn').click(function () {
            let groups = selectGroupObjectsNoCheck();
            if (groups.length < 1) {
                $.notify("At least one group must be selected!!", {
                    type: 'danger',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });            } else {
                addToGroup(groups, 0, "Alias");
                $.notify("Group Aliases saved.", {
                    type: 'success',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });            }
        });
    });

    // Save User Aliases
    $(document).ready(function () {
        $('#saveUserAliasBtn').click(function () {
            let users = selectUserObjectsNoCheck();
            if (users.length < 1) {
                $.notify("At least one user must be selected!!", {
                    type: 'danger',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });            } else {
                addToUser(users, 0, "Alias");
                $.notify("User Aliases saved.", {
                    type: 'success',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });            }
        });
    });

    // Clear Group Notes
    $(document).ready(function () {
        $('#clearGroupNotesBtn').click(function () {
            $('#groupsTab > tbody > tr').each(function () {
                $(this).find('td:eq(4)').find('input[name="groupNoteBox"]').val("");
            });
        });
    });

    // Clear User Notes
    $(document).ready(function () {
        $('#clearUserNotesBtn').click(function () {
            $('#usersTab > tbody > tr').each(function () {
                $(this).find('td:eq(5)').find('input[name="userNoteBox"]').val("");
            });
        });
    });

    // Clear Group Aliases
    $(document).ready(function () {
        $('#clearGroupAliasBtn').click(function () {
            $('#groupsTab > tbody > tr').each(function () {
                $(this).find('td:eq(3)').find('input[name="groupAliasBox"]').val("");
            });
        });
    });

    // Clear Group Aliases
    $(document).ready(function () {
        $('#clearUserAliasBtn').click(function () {
            $('#usersTab > tbody > tr').each(function () {
                $(this).find('td:eq(4)').find('input[name="userAliasBox"]').val("");
            });
        });
    });

    // Add Groups & Users
    $(document).ready(function () {
        $('#btnAddUsers').click(function () {
            let gcount = $("#group_count").val();
            let upgroup = $("#users_per_group").val();
            if (gcount === '' && upgroup === '') {
                $.notify("Please fill out the form", {
                    type: 'danger',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });
            } else if (gcount === '' && upgroup !== '') {
                $.notify("Group Count field is required", {
                    type: 'danger',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });
            } else if (upgroup === '' && gcount !== '') {
                $.notify("Users Per Group field is required", {
                    type: 'danger',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });
            } else {
                $.ajax({
                    type: "POST",
                    url: "http://0.0.0.0:5001/api/v2/resources/group",
                    contentType: "application/json",
                    dataType: "json",
                    data: JSON.stringify({
                        "group_count": gcount,
                        "users_per_group": upgroup
                    }),
                    success: function (response) {
                        console.log(JSON.stringify(response));
                    },
                    complete: function () {
                        reload_groups();
                        $.notify("Successfully added " + gcount + " group(s) with " + upgroup + " user(s) per group.", {
                            type: 'success',
                            animate: {
                                enter: 'animated fadeInRight',
                                exit: 'animated fadeOutRight'
                            },
                            offset: 20,
                            spacing: 10,
                            newest_on_top: true
                        });
                    }
                });
            }
        });
    });

    // Attach Platforms To Groups
    $(document).ready(function () {
        $('#attachPlatBtn').click(function () {
            let main_plats = [];
            $.each($("input[name='mainPlat']:checked"), function () {
                main_plats.push($(this).val());
            });
            let list_of_groups = selectGroupIDs();
            if (list_of_groups.length === 0) {
                $.notify("Please select at least one group for attachment.", {
                    type: 'danger',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });
            } else if (main_plats.length === 0) {
                $.notify("Must select at least one platform!", {
                    type: 'danger',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });
            } else {
                for (let i in list_of_groups) {
                    $.ajax({
                        type: "PUT",
                        url: "http://0.0.0.0:5001/api/v2/resources/group",
                        contentType: "application/json",
                        dataType: "json",
                        data: JSON.stringify({
                            "command": "attach",
                            "group_id": list_of_groups[i],
                            "platform_ids": main_plats
                        }),
                        success: function (response) {
                            console.log(JSON.stringify(response));
                        },
                        complete: function () {
                            reload_groups();
                            $.notify("Attachment successful!", {
                                type: 'success',
                                animate: {
                                    enter: 'animated fadeInRight',
                                    exit: 'animated fadeOutRight'
                                },
                                offset: 20,
                                spacing: 10,
                                newest_on_top: true
                            });
                        }
                    });
                }
            }
        });
    });

    // Populate Platform Attachment Window Modal
    $(document).ready(function () {
        $('#platModalBtn').click(function () {
            // noinspection JSUnusedGlobalSymbols
            $.ajax({
                type: "GET",
                url: "http://localhost:5001/api/v2/resources/platform",
                contentType: "application/json",
                dataType: "json",
                data: {
                    'all': 'True'
                },
                success: function (response) {
                    //Print results
                    console.log("Accessed Database at " + new Date().toUTCString());
                    let array = response;
                    let mainPlats = '';
                    for (let i in array) {
                        let id = array[i]["main"]["id"];
                        let name = array[i]["main"]["name"];
                        let alias = array[i]["main"]["alias"];
                        // mainPlats += '<input name="mainPlat" type="checkbox" value="' + id + '">' + name + ' ' + id + '<br>';
                        mainPlats += `<input name="mainPlat" type="checkbox" value="${id}"> ${alias} ID:${id} Type:${name}  <br>`;


                    }
                    $('#mainPlatRadio').replaceWith(mainPlats);
                }
            });
        });
    });

    // Delete User
    $(document).ready(function () {
        $('#btnDelUsr').click(function () {
            let list_of_users = selectUserIDs();
            if (list_of_users.length === 0) {
                $.notify("Please select at least one user for deletion.", {
                    type: 'danger',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });
            } else {
                $.ajax({
                    type: "DELETE",
                    url: "http://localhost:5001/api/v2/resources/user",
                    contentType: "application/json",
                    dataType: "json",
                    data: JSON.stringify({
                        "list_of_users": list_of_users
                    }),
                    success: function () {
                        reload_groups();
                        $.notify("Successfully deleted " + list_of_users.length + " user(s)", {
                            type: 'success',
                            animate: {
                                enter: 'animated fadeInRight',
                                exit: 'animated fadeOutRight'
                            },
                            offset: 20,
                            spacing: 10,
                            newest_on_top: true
                        });
                    },
                });
            }
        });
    });

    // Delete Group
    $(document).ready(function () {
        $('#groupDelBtn').click(function () {
            let list_of_groups = selectGroupIDs();
            if (list_of_groups.length === 0) {
                $.notify("Please select at least one group for deletion.", {
                    type: 'danger',
                    animate: {
                        enter: 'animated fadeInRight',
                        exit: 'animated fadeOutRight'
                    },
                    offset: 20,
                    spacing: 10,
                    newest_on_top: true
                });
            } else {
                $.ajax({
                    type: "DELETE",
                    url: "http://localhost:5001/api/v2/resources/group",
                    contentType: "application/json",
                    dataType: "json",
                    data: JSON.stringify({
                        "list_of_groups": list_of_groups
                    }),
                    complete: function () {
                        reload_groups();
                        $.notify("Successfully deleted " + list_of_groups.length + " group(s)", {
                            type: 'success',
                            animate: {
                                enter: 'animated fadeInRight',
                                exit: 'animated fadeOutRight'
                            },
                            offset: 20,
                            spacing: 10,
                            newest_on_top: true
                        });
                    }
                });
            }
        });
    });


</script>

</body>

</html>