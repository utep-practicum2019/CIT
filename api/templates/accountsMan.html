<!doctype html>
<html lang="en">
<head>
    <title>Account Manager</title>
    <style>
        #mainArea {
            width: 100%
            height: 100%
        }

        #groupArea {
            width: 100%;
            height: 100%
        }
    </style>


    <!-- Bootstrap core CSS -->
    <link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
          integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" rel="stylesheet">
    <link href="style.css" rel="stylesheet">
</head>

<!--<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>-->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>


<script type="text/javascript">
    visible = 1; //var that keeps track of which table is visible (1 or 2)
    function change_table() {
        var x = document.getElementById("MySelect").value;
        t1 = document.getElementById("groupArea");
        t2 = document.getElementById("mainArea");
        if (visible == 1) {
            visible = 2;
            t1.style.display = 'none';
            t2.style.display = 'block';
        } else {
            visible = 1;
            t1.style.display = 'block';
            t2.style.display = 'none';
        }
    }


</script>


<body onload="change_table()">
<div class="container-fluid">
    <img id="logo" src="http://www.teamorlando.org/wp-content/uploads/2012/11/ARL-2016.jpg">
    <div class="row">
        <div aria-label="First group" class="btn-group mr-2" role="group">

            <button class="btn btn-dark btn-sm menu" type="button"><a href="indexAdmin.html">Managers Menu</a></button>

            <button class="btn btn-dark btn-sm menu" type="button"><a href="connectionMan.html">Connection Manager</a>
            </button>

            <button class="btn btn-dark btn-sm menu active" type="button"><a href="accountsMan.html" id="pressed">Account
                Manager</a></button>

            <button class="btn btn-dark btn-sm menu" type="button"><a href="platMan.html">Platform Manager</a></button>

        </div>
    </div>
</div>
<div class="container-fluid">
    <h2>Accounts:</h2>

    <div class="row">
        <div aria-label="First group" class="btn-group mr-2" role="group">

            <button class="btn btn-dark btn-sm menu" data-target="#addModal" data-toggle="modal" type="button">
                Add Users
            </button>

            <button class="btn btn-dark btn-sm menu" data-target="#importModal" data-toggle="modal" type="button">
                Import Users
            </button>

            <button class="btn btn-dark btn-sm menu" type="button">
                Edit
            </button>

            <select class="btn btn-dark btn-sm menu" id="MySelect" onchange="change_table()">
                <option value="user_table">User table</option>
                <option value="group_table">Group table</option>
            </select>

            <button class="btn btn-dark btn-sm menu" data-target="#deleteUsersModal" data-toggle="modal" type="button">
                Delete Users
            </button>

            <button class="btn btn-dark btn-sm menu" data-target="#deleteGroupModal" data-toggle="modal" type="button">
                Delete Groups
            </button>


        </div>
    </div>
    <div class="table-responsive" id="mainArea">
        <table class="table table-hover" id="usersTab">
            <thead>
            <tr>
                <th>Select:</th>
                <th onclick="sortTable(0)">Username:</th>
                <th>Password:</th>
                <th onclick="sortTable(2)">Group:</th>
                <th>Platform</th>
            </tr>
            </thead>
            <tbody>
            {% for user in users %}
            <tr>
                <td><input aria-label="Checkbox for following text input" id="user_name"
                           type="checkbox" value="{{ user['username'] }}"></td>
                <td>{{ user['username'] }}</td>
                <td>{{ user['password'] }}</td>
                <td>{{ user['group_id'] }}</td>
                <td>H</td>
            </tr>
            {% endfor %}


            </tbody>
        </table>
    </div>
</div>

<div class="container-fluid" id="groupArea">
    <table class="table table-hover" id="groupsTab">
        <thead>
        <tr>
            <th>Select:</th>
            <th onclick="sortTable(0)">Group id:</th>
            <th onclick="sortTable(1)">Members</th>
            <th>Platform</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            {% for group in groups %}
        <tr>
            <td><input aria-label="Checkbox for following text input" onclick="selectGroups()" type="checkbox"
                       value="{{ group['group_id'] }}"></td>
            <td>{{ group['group_id'] }}</td>
            <td>{{ group['members'] }}</td>
            <td>{{ group['platforms'] }}</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>


<script>
    $(document).ready(function () {
        $('#btnDelUsr').click(function () {
            let list_of_users = selectUsers();
            if (list_of_users.length === 0) {
                alert("Please select at least one user for deletion.");
            } else {
                $.ajax({
                    type: "DELETE",
                    url: "http://localhost:5001/api/v2/resources/user",
                    contentType: "application/json",
                    dataType: "json",
                    data: JSON.stringify({
                        "list_of_users": list_of_users
                    }),
                    success: function (response) {
                        // console.log(response["success"] + " status: " + status);
                        $("#groupsTab").load(location.href + " #groupsTab>*", "");
                        $("#usersTab").load(location.href + " #usersTab>*", "");
                        //location.reload();
                    },
                });
            }
        });
    });

    function selectUsers() {
        let list = [];
        $('#usersTab input[type=checkbox]').each(function () {
            if (this.checked) {
                list.push($(this).val())
            }
        });
        return list;
    }

</script>

<!-- Delete Users Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="deleteUsersModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">

        <div class="modal-content">
            <form id="delUserForm">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Are you sure?</h5>
                    <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    All user information will be deleted. This action cannot be undone.
                </div>
            </form>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                <button class="btn btn-danger" data-dismiss="modal" id="btnDelUsr">Delete</button>
            </div>
        </div>

    </div>
</div>


<script>
    $(document).ready(function () {
        $('#groupDelBtn').click(function () {
            let list_of_groups = selectGroups();
            if (list_of_groups.length === 0) {
                alert("Please select at least one user for deletion.");
            } else {
                $.ajax({
                    type: "DELETE",
                    url: "http://localhost:5001/api/v2/resources/group",
                    contentType: "application/json",
                    dataType: "json",
                    data: JSON.stringify({
                        "list_of_groups": list_of_groups
                    }),
                    success: function (response) {
                        // console.log(response["success"] + " status: " + status);
                        $("#groupsTab").load(location.href + " #groupsTab>*", "");
                        $("#usersTab").load(location.href + " #usersTab>*", "");
                        //location.reload();
                    },
                });
            }
        });
    });

    function selectGroups() {
        let list = [];
        $('#groupsTab input[type=checkbox]').each(function () {
            if (this.checked) {
                list.push($(this).val())
            }
        });
        return list;
    }

</script>

<!-- Delete Groups Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="deleteGroupModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form method='POST'>
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Are you sure?</h5>
                    <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    All users information in the group will be deleted. This action cannot be undone.
                </div>
            </form>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                <button class="btn btn-danger" data-dismiss="modal" id="groupDelBtn">Delete</button>
            </div>
        </div>
    </div>
</div>


<!-- Import Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="importModal" role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Import Users</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Your file must be structured in the following manner:<br>
                user1 group1<br>
                user2 group1<br>
                user3 group2<br>
                user4 group2<br>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                <button class="btn btn-primary" type="button">Import</button>
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        $('#btnAddUsers').click(function () {
            let gcount = $("#group_count").val();
            let upgroup = $("#users_per_group").val();
            if (gcount === '' && upgroup === '') {
                alert("Please fill out the form");
            } else if (gcount === '' && upgroup !== '') {
                alert('Group Count field is required')
            } else if (upgroup === '' && gcount !== '') {
                alert('Users Per Group field is required')
            } else {
                $.post("http://localhost:5001/api/v2/resources/group", //Required URL of the page on server
                    JSON.stringify({
                        "group_count": gcount,
                        "users_per_group": upgroup
                    }),
                    function () { // Required Callback Function
                        $("#groupsTab").load(location.href + " #groupsTab>*", "");
                        $("#usersTab").load(location.href + " #usersTab>*", "");
                    });
            }
        });
    });
</script>


<!-- Add Users Modal -->
<div aria-hidden="true" aria-labelledby="exampleModalLabel" class="modal fade" id="addModal" name="addModal"
     role="dialog"
     tabindex="-1">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Add Users</h5>
                <button aria-label="Close" class="close" data-dismiss="modal" type="button">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-footer">
                <div class="modal-body">

                    <form id="addUsersForm">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Number of groups:</span>
                            </div>
                            <input aria-describedby="basic-addon1" class="form-control" id="group_count"
                                   name="group_num"
                                   type="text">
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="basic-addon1">Users per group:</span>
                            </div>
                            <input aria-describedby="basic-addon1" class="form-control" id="users_per_group"
                                   name="users_group"
                                   type="text">
                            <input id="group_id" name="group_id" type="hidden" value="1000">
                        </div>
                    </form>
                    <button class="btn btn-secondary" data-dismiss="modal" type="button">Cancel</button>
                    <button class="btn btn-primary" data-dismiss="modal" id="btnAddUsers">Add Users</button>


                </div>
            </div>
        </div>
    </div>
    <script>
        function sortTable(n) {
            var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
            table = document.getElementById("mainArea");
            switching = true;
            //Set the sorting direction to ascending:
            dir = "asc";
            /*Make a loop that will continue until
            no switching has been done:*/
            while (switching) {
                //start by saying: no switching is done:
                switching = false;
                rows = table.rows;
                /*Loop through all table rows (except the
                first, which contains table headers):*/
                for (i = 1; i < (rows.length - 1); i++) {
                    //start by saying there should be no switching:
                    shouldSwitch = false;
                    /*Get the two elements you want to compare,
                    one from current row and one from the next:*/
                    x = rows[i].getElementsByTagName("TD")[n];
                    y = rows[i + 1].getElementsByTagName("TD")[n];
                    /*check if the two rows should switch place,
                    based on the direction, asc or desc:*/
                    if (dir == "asc") {
                        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                            //if so, mark as a switch and break the loop:
                            shouldSwitch = true;
                            break;
                        }
                    } else if (dir == "desc") {
                        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                            //if so, mark as a switch and break the loop:
                            shouldSwitch = true;
                            break;
                        }
                    }
                }
                if (shouldSwitch) {
                    /*If a switch has been marked, make the switch
                    and mark that a switch has been done:*/
                    rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                    switching = true;
                    //Each time a switch is done, increase this count by 1:
                    switchcount++;
                } else {
                    /*If no switching has been done AND the direction is "asc",
                    set the direction to "desc" and run the while loop again.*/
                    if (switchcount == 0 && dir == "asc") {
                        dir = "desc";
                        switching = true;
                    }
                }
            }
        }
    </script>


    <!--    <script crossorigin="anonymous"-->
    <!--            integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"-->
    <!--            src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>-->
    <script crossorigin="anonymous"
            integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"></script>
    <script crossorigin="anonymous"
            integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"></script>
</body>
</html>